"use client"

import { useEffect, useState, useContext } from "react"
import { useRouter } from 'next/navigation'
import { Progress } from "@/components/ui/progress"
import { Grid } from "react-loader-spinner"
import Modal from 'react-modal';
import analysePRD from "@/lib/analysePRD"
import generateCSV from "@/lib/generateCSV"
import { TaskContext } from "@/components/Context"
import {saveCSV, getCSV} from "@/lib/saveCSV"
import { useSession, signIn, signOut } from "next-auth/react"

export default function Home({ params }) {
    const router = useRouter()
    const { taskId, files } = useContext(TaskContext)
    const {data: session} = useSession()

    const [fileDetails, setFileDetails] = useState({name: "", url: "", size: 0})
    const [downloadTrigger, setDownloadTrigger] = useState(false)
    const [loggedIn, setLoggedIn] = useState(session ? true : false)
    const [authModal, setAuthModal] = useState(false)
    const [completed, setCompleted] = useState(false)
    const [statusMsg, setStatusMsg] = useState("")
    const [progressBar, setProgressBar] = useState(0)

    const handleSignIn = () => { signIn('google') }

    const downloadFile = async (filedata) => { 
        const a = document.createElement('a');
        console.log({downloadFile: filedata})
        a.href = filedata.url;
        a.download = filedata.name;
        document.body.appendChild(a);
        a.click(); a.remove();
    }

    const analysePRDClient = async () => {
        setStatusMsg("Analysing PRD...")
        const progressInterval = setInterval(() => setProgressBar(v => v+2 <= 90 ? v+2 : v), 1000)
        const data = await analysePRD(files.prd)
        console.log(data)
        // await new Promise(r => setTimeout(r, 500));

        setProgressBar(100)
        clearInterval(progressInterval)
        await new Promise(r => setTimeout(r, 500));

        return data.queries
        // return [""]
    }

    const generateCSVClient = async (queries) => {
        setProgressBar(0)
        setStatusMsg("Generating Test Cases...")
        const progressInterval = setInterval(() => setProgressBar(v => v+1 <= 90 ? v+1 : v), 800)
        const data = await generateCSV(queries, files.figma)
        console.log(data)
        // await new Promise(r => setTimeout(r, 900));

        setProgressBar(100)
        clearInterval(progressInterval)
        await new Promise(r => setTimeout(r, 500));

        return data
        // return {csvResponses: [
        //     "```csv\nTest case id,Title,Description,Pre-conditions,Test steps,Expected results,ETA,Priority,Test type,Env,Screen,Verified,Category\nTC_001,Registration Form Validation,Verify user can register with valid email and password,\"User is on the registration page\",1. Navigate to registration form 2. Enter valid email 3. Enter strong password 4. Click submit,User is registered and directed to dashboard,2h,High,Functional,QA,Registration Form,No,User Management\nTC_002,Invalid Email Registration,Verify error message for invalid email format,\"User is on the registration page\",1. Navigate to registration form 2. Enter invalid email 3. Enter password 4. Click submit,Error message \"Invalid email format\" is displayed,1h,Medium,Functional,QA,Registration Form,No,User Management\nTC_003,Password Strength Check,Check password strength indicator during registration,\"User is on the registration page\",1. Navigate to registration form 2. Enter valid email 3. Enter weak password,Password strength indicator shows weak,1.5h,Low,Functional,QA,Registration Form,No,User Management\nTC_004,Login Functionality,Verify user can login with correct credentials,\"User is registered\",1. Navigate to login page 2. Enter registered email 3. Enter correct password 4. Click login,User is logged in and redirected to dashboard,1h,High,Functional,QA,Login Form,No,User Management\nTC_005,Incorrect Password Handling,Ensure appropriate message for incorrect password,\"User is registered\",1. Navigate to login page 2. Enter registered email 3. Enter incorrect password 4. Click login,Error message \"Incorrect password\" is displayed,45m,High,Functional,QA,Login Form,No,User Management\nTC_006,Password Reset Email,Verify password reset email is sent on request,\"User is registered\",1. Navigate to login page 2. Click \"Forgot Password\" 3. Enter registered email and submit,Password reset email is sent to the user,1.5h,High,Functional,QA,Login Form,No,User Management\nTC_007,Password Reset Link Functionality,Check password reset link functionality,\"Password reset email is received\",1. Open password reset email 2. Click reset link 3. Enter new password 4. Submit,Password reset is successful and user can login with new password,2h,High,Functional,QA,Password Reset,No,User Management\nTC_008,Responsive Design,Validate responsive design across devices,\"Access to various devices\",1. Open application on multiple device sizes 2. Check layout and usability,Application is responsive and UI is consistent,3h,Medium,Non-functional,Staging,All Screens,No,UI\/UX\nTC_009,Dashboard Load Time,Verify dashboard loads under 1.5 seconds,User logged in,1. Login to application 2. Navigate to dashboard,Dashboard loads within 1.5 seconds,2h,Medium,Performance,QA,Dashboard,No,Performance\nTC_010,Task Assignment,Ensure task can be assigned to a team member,\"User logged in, task available\",1. Navigate to My tasks 2. Select a task 3. Assign to a team member,Task is successfully assigned,1h,High,Functional,QA,My Tasks,No,User Management\nTC_011,Calendar Widget Navigation,Verify calendar widget navigation works,\"User logged in\",1. Navigate to dashboard 2. Use calendar widget to select a date,Tasks for selected date are displayed,1h,Low,Functional,QA,Dashboard,No,UI\/UX\nTC_012,Notifications Display,Check notifications are displayed correctly,\"User logged in, notifications available\",1. Navigate to Notifications 2. Verify notification list,Notifications are listed correctly,1h,Medium,Functional,QA,Notifications,No,User Management\nTC_013,Search Functionality,Ensure search functionality works,\"User logged in, tasks available\",1. Navigate to My tasks 2. Use search bar to find a task,Relevant tasks are displayed based on search,1.5h,Medium,Functional,QA,My Tasks,No,UI\/UX\nTC_014,Advanced Filter Options,Verify advanced filters can be applied,\"User logged in\",1. Navigate to My tasks 2. Select 'Add filters' 3. Apply multiple filters,Tasks are filtered and displayed correctly,2h,Medium,Functional,QA,My Tasks,No,UI\/UX\nTC_015,Logout Functionality,Ensure user can logout successfully,\"User logged in\",1. Click logout in settings menu,User is logged out and redirected to login page,30m,High,Functional,QA,Settings,No,User Management\nTC_016,Data Encryption Validation,Verify data encryption in transit,\"Access to network tools\",1. Monitor network traffic during login 2. Ensure data is encrypted,Data is encrypted as expected,3h,High,Security,Development,Login Form,No,Security\nTC_017,Collaborative Task Update,Ensure team members see updates on shared tasks,\"User logged in, shared tasks available\",1. Change task status 2. Confirm team members see updates,Team members see updated task information,3h,Medium,Functionality,Staging,My Tasks,No,User Management\nTC_018,Task Creation and Save,Verify task can be created and saved,\"User logged in\",1. Go to My tasks 2. Click 'New task' 3. Fill in task details 4. Save task,Task is created and visible in task list,1h,High,Functional,QA,My Tasks,No,User Management\nTC_019,Session Expiration Handling,Ensure user session expires after set duration without activity,\"User logged in\",1. Wait for session timeout duration without interaction 2. Attempt action after timeout,User is logged out and prompted to log back in,2h,Medium,Security,QA,All Screens,No,Security\nTC_020,Error Messages Consistency,Check for consistent error messages across forms,\"Access to all forms\",1. Trigger error states across various forms 2. Compare error messages,All error messages are consistent and user-friendly,3h,Low,Functional,QA,All Forms,No,UI\/UX\n```",
        //     "```csv\nTest case id,Title,Description,Pre-conditions,Test steps,Expected results,ETA,Priority,Test type,Env,Screen,Verified,Category\nTC01,Create Task,Verify user can create a task with all fields,\"User logged in\",1. Click 'New Task' button. 2. Enter task details. 3. Save task.,Task is created and displayed in the task list.,5m,High,Functional,Dev,My tasks,Not verified,Task Management\nTC02,Edit Task,Verify user can edit an existing task,\"User logged in, task created\",1. Select a task. 2. Click 'Edit'. 3. Modify details. 4. Save changes.,Task details are updated in the list.,5m,High,Functional,Dev,My tasks,Not verified,Task Management\nTC03,Delete Task,Verify user can delete a task,\"User logged in, task created\",1. Select a task. 2. Click 'Delete'. 3. Confirm deletion.,Task is removed from the list.,5m,High,Functional,Dev,My tasks,Not verified,Task Management\nTC04,Set Priority,Verify priority can be set and displayed correctly,\"User logged in, task created\",1. Select a task. 2. Edit task priority. 3. Save changes.,Priority is updated and displayed correctly.,5m,Medium,Functional,Dev,My tasks,Not verified,Task Management\nTC05,Set Due Date,Verify due date can be set for a task,\"User logged in, task created\",1. Select a task. 2. Edit due date. 3. Save changes.,Due date is correctly updated in the list.,5m,Medium,Functional,Dev,My tasks,Not verified,Task Management\nTC06,Complete Task,Verify user can mark a task as complete,\"User logged in, task created\",1. Select a task. 2. Mark as complete. 3. Verify status.,Task status updated to complete.,5m,High,Functional,Dev,My tasks,Not verified,Task Management\nTC07,Reorder Task,Verify tasks can be dragged and dropped to reorder,\"User logged in, multiple tasks created\",1. Drag a task to a new position. 2. Drop the task.,Tasks are reordered as expected.,5m,Medium,Functional,Dev,My tasks,Not verified,Task Management\nTC08,Responsive Design,Verify responsive design on various devices,User can access the app,Resize the window to different dimensions.,UI adjusts smoothly on different screens.,10m,Medium,UI,Prod,Dashboard,Not verified,UI\/UX\nTC09,Data Load,Verify task list loads under 1.5 seconds,User can access the app,1. Open My tasks page.,Tasks load in under 1.5 seconds.,5m,High,Performance,Dev,My tasks,Not verified,Performance\nTC10,Secure Login,Verify secure API authentication,User can access the login page,1. Enter credentials. 2. Submit login form.,User is logged in securely.,5m,High,Security,Prod,Login,Not verified,Security\nTC11,Notification Reminder,Verify users receive reminders for due tasks,User logged in and tasks with due dates set,1. Await reminder notification.,User receives notification before due date.,Varies,High,Functional,Prod,Notifications,Not verified,Task Management\nTC12,Search Task,Verify user can search tasks,\"User logged in, tasks available\",1. Enter search term. 2. Press enter.,Relevant tasks are displayed.,5m,Medium,Functional,Dev,My tasks,Not verified,Task Management\nTC13,Filter Task,Verify tasks can be filtered by criteria,\"User logged in, tasks available\",1. Open filter options. 2. Apply filters.,Tasks are filtered according to criteria.,5m,Medium,Functional,Dev,My tasks,Not verified,Task Management\nTC14,User Registration,Verify user can register with email,Access to registration page,1. Enter registration details. 2. Submit form.,User receives confirmation and is registered.,Varies,High,Functional,Prod,Register,Not verified,General\nTC15,Login,Verify user can log in with valid credentials,Registered user,1. Enter username and password. 2. Click login.,User is logged in successfully.,5m,High,Functional,Prod,Login,Not verified,General\nTC16,Log Out,Verify user can log out,\"User logged in\",1. Click 'Log out' button.,User is logged out and redirects to login page.,5m,High,Functional,Prod,My tasks,Not verified,General\nTC17,Secure Form Validation,Verify form validations are enforced,Access to task form,1. Submit form without data.,Validation messages are displayed.,5m,Medium,Security,Dev,Task Form,Not verified,Security\nTC18,Encryption,Verify data is encrypted in transit,\"Access to system, task created\",Monitor network for plaintext data transmission.,No plain data is visible in transit.,Varies,High,Security,Prod,All,Not verified,Security\nTC19,Task List Sorting,Verify task list can be sorted by priority,\"User logged in, tasks available\",1. Sort tasks by priority.,Tasks are sorted correctly by priority.,5m,Medium,Functional,Dev,My tasks,Not verified,Task Management\nTC20,Concurrent Access,Verify multiple users can access project tasks concurrently,Multiple registered users,1. User A and B access the same project. 2. Perform task operations.,Both users see consistent task data.,Varies,High,Functional,Prod,Team Project,Not verified,Collaboration\n```",
        //     "```csv\nTest case id,Title,Description,Pre-conditions,Test steps,Expected results,ETA,Priority,Test type,Env,Screen,Verified,Category\nTC001,User Invitation,Verify user can invite another user to the team,\"User logged in, team exists\",1. Go to 'Dashboard' 2. Click 'Invite user' 3. Enter email 4. Send invitation,User receives invitation email,5 min,High,Functional,Web,Dashboard,No,Functional\nTC002,Assign Task,Verify tasks can be assigned to specific users,\"User logged in, task created\",1. Go to 'My Tasks' 2. Select task 3. Use 'Assignee' dropdown 4. Assign to user,Task is visible under assigned user's 'My Tasks',5 min,High,Functional,Web,\"My tasks\",No,Functional\nTC003,Shared Task Board,Verify shared task board displays tasks correctly,\"User logged in, tasks assigned\",1. Go to 'Dashboard' 2. Check shared task board section,All tasks are visible based on assignment,5 min,High,Functional,Web,Dashboard,No,Functional\nTC004,Responsive Design,Check responsive design on various devices,\"Access to multiple devices\",1. Open on various devices 2. Verify layout and navigation,View adapts properly to all screen sizes,10 min,Medium,UI\/UX,Web,Dashboard,No,Non-functional\nTC005,Task Board Sorting,Verify tasks can be sorted by priority,\"User logged in, tasks listed\",1. Go to 'My tasks' 2. Use sort filter by priority,Tasks are sorted correctly by priority,5 min,Medium,Functional,Web,\"My tasks\",No,Functional\nTC006,User Search,Verify user can search tasks,\"User logged in, tasks exist\",1. Use search bar 2. Enter task name,Matching tasks are displayed,5 min,Low,Functional,Web,\"My tasks\",No,Functional\nTC007,Task Filter Functionality,Verify filter functionality for tasks,\"User logged in, multiple tasks available\",1. Open 'Add filters' 2. Select filter criteria,Tasks are filtered based on selection,5 min,Medium,Functional,Web,\"My tasks\",No,Functional\nTC008,Load Time,Verify overall page load time,\"Supported browser, stable internet\",1. Open any page 2. Check load completion time,Load time is under 1.5 seconds,5 min,High,Performance,Web,Various,No,Non-functional\nTC009,Notification Access,Verify notifications can be accessed and read,\"User logged in\",1. Go to 'Notifications' 2. Check message details,\"Notifications open, message readable\",5 min,Medium,Functional,Web,Notifications,No,Functional\nTC010,Task State Update,Verify task state can be updated,\"User logged in, task exists\",1. Go to 'My tasks' 2. Update task state,Task state changes and updates on list,5 min,Medium,Functional,Web,\"My tasks\",No,Functional\nTC011,Priority Filter,Verify tasks can be filtered by priority,\"User logged in, tasks with priorities\",1. Open 'Add filters' 2. Select 'Priority',Tasks are filtered by selected priority,5 min,Medium,Functional,Web,\"My tasks\",No,Functional\nTC012,Task View Navigation,Verify smooth transition between task states,\"User logged in\",1. Navigate task views,Transitions are smooth without delays,5 min,Low,UI\/UX,Web,\"My tasks\",No,Non-functional\nTC013,Invite Security,Verify security in user invitation,\"User logged in\",1. Initiate invite process 2. Examine communication security,Invitation securely sent with encryption,10 min,High,Security,Web,Dashboard,No,Security\nTC014,Data Encryption,Verify data is encrypted at rest and in transit,\"Data access permission\",1. Review data storage and retrieval,Data correctly encrypted at all points,10 min,High,Security,Web,Various,No,Security\nTC015,Task Addition,Verify user can add new tasks,\"User logged in\",1. Go to 'My tasks' 2. Click 'New Task' 3. Fill details and save,New task added and visible in list,5 min,High,Functional,Web,\"My tasks\",No,Functional\nTC016,Category Management,Check categories can be modified,\"User logged in\",1. Navigate to category section 2. Edit\/Remove categories,Categorization updates correctly,5 min,Medium,Functional,Web,\"My tasks\",No,Functional\nTC017,Task Deadline Update,Verify task deadlines can be updated,\"User logged in, task exists\",1. Go to 'My tasks' 2. Update task deadline,Deadline changes are saved and reflected,5 min,Medium,Functional,Web,\"My tasks\",No,Functional\nTC018,Search Autocomplete,Check task search autocomplete,\"User logged in, list available\",1. Use search bar 2. Type task name,Autocomplete suggests matching tasks,5 min,Low,Functional,Web,\"My tasks\",No,Functional\nTC019,Logout Functionality,Verify logout operation,\"User logged in\",1. Click 'Logout' 2. Confirm logout,User is safely logged out,5 min,High,Functional,Web,Logout,No,Functional\nTC020,Settings Update,Verify settings modification,\"User logged in\",1. Go to 'Settings' 2. Modify settings,Changes are saved and effective,5 min,Medium,Functional,Web,Settings,No,Functional\n```",
        //     "```csv\nTest case id,Title,Description,Pre-conditions,Test steps,Expected results,ETA,Priority,Test type,Env,Screen,Verified,Category\nTC001,Verify email notification on task assignment,Check that an email is sent to the user upon task assignment,User has email configured in their profile,\"1. Assign a task to a user\n2. Check the user's email inbox\",User receives an email notification of task assignment,5m,High,Functional,All,Notifications,No,Email Notifications\nTC002,Verify daily summary email with pending tasks,Ensure daily email summary contains all pending tasks,User should have pending tasks,\"1. Wait for the daily summary email delivery\n2. Open the email\",Email lists all pending tasks accurately,10m,High,Functional,All,Email Client,No,Summary Emails\nTC003,Verify email notification settings UI,Check the UI for email notification settings is accessible and functional,User is logged in,\"1. Navigate to Settings\n2. Open Notifications\",UI allows users to configure their email preferences,5m,Medium,UI,All,Settings,No,General UI\nTC004,Verify task assignment UI feedback,Ensure UI shows feedback after assigning a task,Task and assignee available,\"1. Assign a task via UI\n2. Observe UI response\",Feedback or confirmation is shown after task assignment,5m,Medium,UI,All,My tasks,No,User Feedback\nTC005,Check responsive design on notification settings,Verify notification settings screen adaptability on different devices,User has notification settings available,\"1. Open notification settings\n2. Resize browser window or use different devices\",Screen adjusts properly for all resolutions,10m,Low,UI,All,Settings,No,Responsive Design\nTC006,Ensure email notification upon task reassignment,Test email notification sending when a task is reassigned,Original task in assigned state,\"1. Reassign the task to a different user\n2. Check email of new assignee\",New assignee receives notification email,5m,Medium,Functional,All,Notifications,No,Email Notifications\nTC007,Validate pending task list accuracy,Check daily summary email shows correct pending task list,Tasks with different statuses,\"1. Receive daily email\n2. Validate task list corresponds to pending tasks\",Pending tasks accurately reflected in daily summary,10m,High,Functional,All,Email Client,No,Data Accuracy\nTC008,Check load time for dashboard screen,Ensure the dashboard screen loads within performance limits,None,\"1. Access the dashboard\n2. Measure load time\",Load time is under 1.5 seconds,2m,High,Performance,All,Dashboard,No,Performance Testing\nTC009,Ensure secure API authentication for task retrieval,Ensure API calls for task management require authentication,API environment configured,\"1. Attempt to retrieve tasks via API without auth\n2. Attempt with valid authentication\",Unauthenticated access is denied,10m,High,Security,Backend,API Testing,No,Security\nTC010,Assess layout usability,Verify intuitive task layout and navigation,User has tasks to manage,\"1. Browse through tasks\n2. Navigate among different task views\",Layout is easy to understand and navigate,5m,Medium,Usability,All,My tasks,No,UI\/UX\nTC011,Check task filtering functionality,Verify task filtering system is working with various filters,Multiple tasks available with variances,\"1. Apply filters (e.g., Priority, Date)\n2. Evaluate task list changes\",Tasks are filtered correctly according to criteria,5m,High,Functional,All,My tasks,No,Filters\nTC012,Validate creation of new tasks,Ensure that new tasks can be created and saved successfully,User has access to create tasks,\"1. Navigate to My tasks\n2. Click 'New task'\n3. Input task details and save\",Task is saved and visible in the task list,5m,High,Functional,All,My tasks,No,Task Management\nTC013,Verify logout functionality,Ensure user can logout and session is terminated,User is logged in,\"1. Click 'Logout'\n2. Confirm session ends\",User is successfully logged out,2m,High,Functional,All,All,No,Authentication\nTC014,Validate secure data encryption,Ensure task data encryption is maintained at rest,Database connection available,\"1. Access database\n2. Verify data storage with encryption\",Data is stored in encrypted format,10m,High,Security,Database,Data Storage,No,Security\nTC015,Test task due date sorting,Check if tasks are sorted correctly by due date,Tasks with different due dates,\"1. Open My tasks\n2. Sort tasks by due date\",Tasks are ordered by date accurately,5m,Medium,Functional,All,My tasks,No,Sorting\nTC016,Ensure task category visibility,Verify all task categories are visible and selectable,User has multiple task categories,\"1. Open task filter panel\n2. View categories\",All categories are visible and active for selection,3m,Medium,Functional,All,My tasks,No,Filters\nTC017,Check API data retrieval performance,Measure time for task data retrieval via API,None,\"1. Execute API call for task retrieval\n2. Record response time\",Response time is within performance criteria,5m,Medium,Performance,Backend,API Testing,No,Performance\nTC018,Validate intuitive task assignment feature,Ensure task assignment process is user-friendly,Task list with assignees,\"1. Assign tasks to users\n2. Observe the process for simplicity\",Task assignment is straightforward,5m,High,Usability,All,My tasks,No,UX\nTC019,Verify intuitive task tracking UI,Ensure users comprehend task progress and details clearly,Tasks with various statuses,\"1. Open task tracking\n2. Review task statuses and details\",Users can easily track and understand task progression,5m,Medium,Usability,All,Dashboard,No,UI\/UX\nTC020,Test task edit capability,Check if tasks can be edited post-creation,User has created tasks,\"1. Open a task\n2. Edit task details\n3. Save changes\",Task updates are reflected correctly,5m,High,Functional,All,My tasks,No,Task Management\n```",
        //     "```csv\nTest case id,Title,Description,Pre-conditions,Test steps,Expected results,ETA,Priority,Test type,Env,Screen,Verified,Category\nTC-001,Responsive Design on Desktop,Verify application layout is responsive on desktop with various resolutions,\"User is logged in, Using supported browser\",1. Open application in desktop browser; 2. Resize browser window to different resolutions,\"Layout should adjust according to window size, No content overlap\",1h,High,Functional,Prod,All,No,UI\/UX\nTC-002,Responsive Design on Mobile,Verify application layout is responsive on mobile devices,\"User is logged in, Access to mobile device\",1. Open application on mobile browser; 2. Test different orientations (portrait\/landscape),\"Layout should be consistent, touch accessible in both orientations\",1h,High,Functional,Prod,All,No,UI\/UX\nTC-003,Light Mode Appearance,Verify UI appearance is correct in Light mode,\"User is logged in, Light mode is enabled\",1. Navigate through the app screens,\"Proper colors and fonts should be visibly optimized for light mode\",30m,Medium,Functional,Prod,Dashboard,No,UI\/UX\nTC-004,Dark Mode Appearance,Verify UI appearance is correct in Dark mode,\"User is logged in, Dark mode is enabled\",1. Navigate through the app screens,\"Proper colors and fonts should be visibly optimized for dark mode\",30m,Medium,Functional,Prod,Dashboard,No,UI\/UX\nTC-005,Toggle Light\/Dark Mode,Verify toggle switch changes UI mode,\"User is logged in\",1. Locate toggle switch; 2. Switch modes between light and dark,\"UI mode changes without content disruption\",30m,High,Functional,Prod,Settings,No,UI\/UX\nTC-006,Task List Display,Verify task lists are displayed correctly,\"User logged in with existing tasks\",1. Navigate to 'My tasks' page,\"Content displayed should match the backlog tasks,including all details\",30m,High,Functional,Prod,My Tasks,No,Functional\nTC-007,Task Filter,Verify task filtering function works as expected,\"User is logged in, Has multiple tasks\",1. Go to 'My tasks'; 2. Add filters; 3. Apply filters,\"Task list is updated as per applied filters\",45m,Medium,Functional,Prod,My Tasks,No,Functional\nTC-008,New Task Creation,Verify the creation of a new task,\"User logged in on My tasks page\",1. Click 'New task' button; 2. Enter task details; 3. Save task,Task is saved and visible in task list,45m,High,Functional,UAT,My Tasks,No,Functional\nTC-009,Reminder Notification,Verify user receives reminders for tasks,\"User has tasks due soon\",1. Wait for task due time,\"Notification is sent as a reminder\",45m,High,Functional,Prod,Notifications,No,Functional\nTC-010,Load Time Metric,Verify application meets load time requirement,\"User is logged in, Network is stable\",1. Measure load time across different pages,\"Load time should be under 1.5 seconds\",1h,High,Non-Functional,Prod,All,No,Performance\nTC-011,Secure Login,Verify login process is secure,\"User has valid credentials\",1. Attempt login; 2. Check network requests,\"Login should be encrypted with secure connection\",1h,High,Security,Prod,Login,No,Security\nTC-012,Logout Functionality,Verify user can logout successfully,\"User is logged in\",1. Click on 'Logout' button,User is logged out and redirected to login page,15m,Medium,Functional,Prod,Settings,No,Functional\nTC-013,Sidebar Navigation,Verify sidebar navigation works correctly,\"User is logged in\",1. Use sidebar to navigate between pages,User should successfully navigate to the selected page,30m,Medium,Functional,Prod,Dashboard,No,Functional\nTC-014,Task Details Display,Verify display of task details,\"User is logged in, Task exists\",1. Click on a task from the task list,Task details appear in a modal or new page,30m,Medium,Functional,Prod,My Tasks,No,Functional\nTC-015,Data Encryption,Verify data is encrypted at rest and in transit,\"User is logged in\",1. Inspect storage\/encryption policy,\"All sensitive data should be encrypted properly\",2h,High,Security,Prod,All,No,Security\nTC-016,Search Functionality,Verify the search function works across the application,\"User is logged in, Search implemented\",1. Enter a search query; 2. Review search results,\"Matches displayed should be relevant to query\",30m,High,Functional,Prod,Dashboard,No,Functional\nTC-017,Task Priority Update,Verify user can update task priority,\"User logged in, Task exists\",1. Edit task; 2. Change priority; 3. Save changes,\"Priority updated without errors\",45m,Medium,Functional,Prod,My Tasks,No,Functional\nTC-018,UI Transitions,Verify UI transitions are smooth,\"User is logged in\",1. Navigate and interact with various UI elements,Smooth and visually pleasing transitions,30m,Medium,Functional,Prod,All,No,UI\/UX\nTC-019,Input Validation,Verify all form inputs have validation checks,\"User is logged in\",1. Submit forms with invalid\/empty data; 2. Check for feedback,\"Alerts should indicate correction needs\",30m,High,Security,Prod,My Tasks,No,Security\nTC-020,Email Notifications,Verify email notifications for updates,\"User has email setup\",1. Trigger a notification; 2. Check email,Notification email should be sent and correctly formatted,1h,Medium,Functional,Prod,Notifications,No,Functional\n```",
        //     "```csv\nTest case id,Title,Description,Pre-conditions,Test steps,Expected results,ETA,Priority,Test type,Env,Screen,Verified,Category\nTC001,Input Validation - Task Form,Verify input validation on task creation form,\"Open the application, navigate to 'Dashboard'.\",1. Click on 'Add widget' in 'Dashboard'. 2. Enter invalid data in task fields. 3. Submit the form.,Error messages are displayed indicating invalid input,2h,High,Functional,Web,Dashboard,No,Security\nTC002,JWT Token Issuance,Verify JWT token is issued upon successful authentication.,User credentials exist in the database.,1. Navigate to 'Login'. 2. Enter valid credentials. 3. Submit the form.,JWT token is issued and can be viewed in HTTP response.,1h,High,Functional,Web,Login,No,Security\nTC003,JWT Token Validation,Verify JWT token validation for restricted resources.,JWT token is issued and stored in a session.,1. Use the token to access a restricted API. 2. Validate response.,Access is granted based on valid JWT token.,1h,High,Functional,Web,API,No,Security\nTC004,Rate Limiting - Login,Verify rate limiting on login attempts to prevent brute force attacks.,Configured rate limit set on login endpoint.,1. Attempt to login with invalid credentials more than permitted limit. 2. Observe system behavior.,Login attempts are throttled and user is blocked after limit exceeded.,2h,High,Functional,Web,Login,No,Security\nTC005,Responsive Design Test - Dashboard,Check responsive design on different devices for 'Dashboard' view.,None,1. Access the 'Dashboard' from various devices. 2. Observe layout changes.,Layout adjusts appropriately for device screen size.,3h,Medium,Non-functional,Web,Dashboard,No,UI_UX\nTC006,Task Form Error Messages,Verify error messages for invalid inputs on task form.,User is on 'Dashboard' page.,1. Open task form. 2. Enter invalid data in fields. 3. Submit form.,User sees specific error messages for each invalid input.,1h,High,Functional,Web,Dashboard,No,UI_UX\nTC007,Login Attempts Feedback,Verify user receives feedback on login attempt status.,User is on the login page.,1. Attempt to log in with valid then invalid credentials. 2. Observe feedback messages.,Appropriate success or error feedback is shown to the user.,1h,High,Functional,Web,Login,No,UI_UX\nTC008,Task Sorting Feature,Check sorting functionality in 'My Tasks' based on priority and date.,User is on 'My Tasks' page.,1. Apply sorting based on priority. 2. Apply sorting based on date. 3. Validate results.,Tasks are sorted correctly according to selection.,2h,Medium,Functional,Web,My Tasks,No,UI_UX\nTC009,Navigation Bar Links,Validate navigation links in the navigation bar.,User is on any page of the application.,1. Click on each link in the navigation bar. 2. Validate the redirection.,User is correctly navigated to the corresponding page.,1h,Low,Functional,Web,All Screens,No,UI_UX\nTC010,Logout Functionality,Ensure user can logout of the application successfully.,User is logged into the application.,1. Click on 'Logout'. 2. Validate redirection to login page.,User is logged out and redirected to login page.,1h,Medium,Functional,Web,Logout,No,Security\nTC011,Search Functionality,Verify search functionality in 'My Tasks'.,\"User is on 'My Tasks', tasks are available.\",1. Enter search term in search bar. 2. Submit search. 3. Validate results.,Relevant tasks are displayed based on search input.,2h,High,Functional,Web,My Tasks,No,UI_UX\nTC012,Task Filter Application,Validate filters in task management screen.,Tasks exist in the system.,\"1. Open 'My Tasks'. 2. Apply filters like priority, team, status. 3. Validate filtered tasks.\",Tasks are filtered accurately based on selected criteria.,2h,Medium,Functional,Web,My Tasks,No,UI_UX\nTC013,Task Detail View,Ensure detailed task view is accessible.,User is on 'My Tasks'.,\"1. Click on a task. 2. View task details.\",Task details are correctly displayed.,1h,High,Functional,Web,My Tasks,No,UI_UX\nTC014,Performance Load Time,Verify the load time of the screen is under 1.5 seconds.,Application is deployed in test environment.,1. Load Dashboard and My Tasks pages. 2. Use browser tools to measure load time.,Pages load within specified time limit.,1h,High,Non-functional,Web,All Screens,No,Performance\nTC015,Data Encryption at Rest,Ensure all user data at rest is encrypted.,Access to database is required.,1. Inspect stored data formats and encryption status.,All sensitive data is stored encrypted.,8h,High,Security,Web,Database,No,Security\nTC016,Data Encryption in Transit,Verify data is encrypted in transit between client and server.,Access to network traffic logs.,1. Analyze traffic between client and server. 2. Check encryption status.,Data is encrypted during transmission.,4h,High,Security,Web,Network,No,Security\nTC017,Task Creation and Assignment,Test task creation and assignment functionality for team users.,User is logged in as a team user.,1. Create a new task. 2. Assign it to a team member. 3. Validate assignment notification.,Task is created and assigned correctly.,3h,High,Functional,Web,My Tasks,No,Functional\nTC018,User Notifications,Verify user receives notifications for task updates.,Notifications are enabled.,1. Update a task. 2. Observe notifications received by user.,Users get timely notifications upon task changes.,2h,Medium,Functional,Web,My Tasks,No,UI_UX\nTC019,Task Completion Tracking,Verify task completion tracking in 'My Tasks' view.,Tasks have completion status.,1. Mark tasks as complete. 2. Observe tracking updates.,Task completion status is updated accurately.,2h,Medium,Functional,Web,My Tasks,No,Functional\nTC020,Reminder Functionality,Ensure reminders can be set for tasks.,User is logged in and on 'My Tasks'.,1. Set a reminder for a task. 2. Observe reminder behavior.,Reminder is activated accurately for task.,2h,Medium,Functional,Web,My Tasks,No,Functional\n```"
        // ]}
    }

    useEffect(() => {
        if (downloadTrigger && session) {
            downloadFile(fileDetails)
        }
    }, [downloadTrigger])

    useEffect(() => {
        (async function() {
            // Check CSV exists
            const data = await getCSV(taskId)

            if (data) {
                setFileDetails(data)
                setCompleted(true)
            } else {
                const queries = await analysePRDClient()
                const csvData = await generateCSVClient(queries)
                console.log(csvData)
    
                setProgressBar(0)
                setStatusMsg("Compiling CSV...")
                const data = await saveCSV(csvData.csvResponses, taskId)
                setFileDetails(data)
                setTimeout(() => setProgressBar(100), 500)
                setTimeout(() => setCompleted(true), 800)
            }
        })()
    }, [])

    const AuthModal = () => {
        return (
            <Modal
                isOpen={downloadTrigger && !session && authModal}
                onRequestClose={() => setAuthModal(false)}
                overlayClassName="fade-in h-screen w-screen absolute inset-0 bg-white/30 backdrop-blur flex items-center justify-center"
                className="fade-up w-full max-w-2xl rounded-xl flex flex-col items-center text-center bg-white p-12 outline-[#FA4EA9] outline-1"
            >
                <h2 className="text-xl font-semibold mb-12">Create an account to download test cases</h2>
                <button onClick={handleSignIn} className="cursor-pointer w-max flex items-center px-10 py-3 rounded-lg outline-1 outline-gray-600">
                    <img src="/img/google.svg" alt="google icon" className="h-6 mr-3" />
                    <span>Sign up with Google</span>
                </button>
                <p className="mt-4">Already have an account? <a className="underline font-semibold">Sign in</a></p>
            </Modal>
        )
    }

    const DownloadView = () => (
        (downloadTrigger && session) ? (
            <div className="w-full rounded-xl flex flex-col items-center text-center upload-success border-4 p-12">
                <img src="/img/checkmark.svg" alt="checkmark icon" className="h-32 mb-6" />
                <h1 className="text-4xl font-semibold mb-3">Download Successful!</h1>
                <p className="text-lg mb-3 text-gray-500">Your CSV file has been downloaded successfully</p>
                <p className="mb-12 text-gray-500 font-mono">{fileDetails.name} ({Math.floor(fileDetails.size / 1024)} KB)</p>

                <div className="flex space-x-3">
                    <button onClick={() => router.replace("/")} className="bg-[#FA4EA9] mr-12 cursor-pointer px-8 py-4 text-white font-semibold text-lg rounded-lg w-[251px]">
                        <span>← Back to Home</span>
                    </button>
                    <button className="bg-[#FA4EA9] cursor-pointer px-4 py-4 text-white font-semibold text-lg rounded-lg">
                        <img src="/img/share.svg" alt="" className="h-8 aspect-square" />
                    </button>
                    <button className="bg-[#FA4EA9] cursor-pointer px-4 py-4 text-white font-semibold text-lg rounded-lg">
                        <img src="/img/google_drive.svg" alt="" className="h-8 aspect-square" />
                    </button>
                    <button className="bg-[#FA4EA9] cursor-pointer px-4 py-4 text-white font-semibold text-lg rounded-lg">
                        <img src="/img/whatsapp.svg" alt="" className="h-8 aspect-square" />
                    </button>
                </div>
            </div>
        ) : (
            <div className="w-full rounded-xl flex flex-col items-center text-center border-[#FA4EA9] border-4 bg-[#FFF1FB] p-12">
                <img src="/img/download.svg" alt="cloud_download icon" className="h-64" />
                <h1 className="text-4xl font-semibold mb-3">Generation Successful!</h1>
                <p className="text-lg mb-3 text-gray-500">Your CSV file has been generated successfully</p>
                <p className="mb-12 text-gray-500 font-mono">{fileDetails.name} ({Math.floor(fileDetails.size / 1024)} KB)</p>

                <button onClick={() => { setDownloadTrigger(true); setAuthModal(!session) }} className={`bg-[#FA4EA9] cursor-pointer px-8 py-4 text-white font-semibold text-lg rounded-lg w-[251px]`}>
                    <span>Download</span>
                </button>
            </div>
        )
    )

    return (
        <div className="w-screen h-screen flex items-center justify-center">
            <div className="flex flex-col items-center max-w-4xl w-full text-gray-600">

                {!completed ?
                    <>
                        <Grid visible={true} height="80" width="80" color="#FA4EA9" ariaLabel="grid-loading" radius="12.5" wrapperStyle={{}} wrapperClass="grid-wrapper" />
                        <Progress value={progressBar} className="max-w-xl my-8 [&>*]:bg-[#FA4EA9] bg-[#FA4EA9]/25" />
                        <h1 className="text-2xl font-semibold mb-3">{statusMsg}</h1>
                        <p className="font-semibold mb-6 text-gray-500">Please don’t go back or close the window while the page is loading</p>
                    </>
                :
                    <DownloadView />
                }

                <AuthModal />
            </div>
        </div>
    )
}
